<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML DIR="LTR"><HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>IPort::NewRegistryKey</TITLE>
<SCRIPT SRC="../scripts/linkcss.js"></SCRIPT><SCRIPT SRC="../scripts/langref.js"></SCRIPT><META NAME="MS-HKWD" CONTENT="IPort::NewRegistryKey">
</HEAD>
<BODY TOPMARGIN="0">
<DIV STYLE="display:none;">
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_access_mask_kr">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_object_attributes_kr">
</OBJECT>
<OBJECT ID="hhobj_3" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_zwcreatekey_kr">
</OBJECT>
<OBJECT ID="hhobj_4" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_initializeobjectattributes_kr">
</OBJECT>
<OBJECT ID="hhobj_5" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_zwcreatekey_kr">
</OBJECT>
<OBJECT ID="hhobj_6" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_initializeobjectattributes_kr">
</OBJECT>
<OBJECT ID="hhobj_7" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_object_attributes_kr">
</OBJECT>
<OBJECT ID="hhobj_8" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_access_mask_kr">
</OBJECT>
</DIV>


<TABLE CLASS="buttonbarshade" CELLSPACING=0><TR><TD>&nbsp;</TD></TR></TABLE>
<TABLE CLASS="buttonbartable" CELLSPACING=0>
<TR ID="hdr"><TD CLASS="runninghead" NOWRAP>Streaming&nbsp;Devices&nbsp;(Video&nbsp;and&nbsp;Audio):&nbsp;Windows&nbsp;DDK</TD></TR>
</TABLE>
<H1><A NAME="ddk_iport_newregistrykey_ks"></A>IPort::NewRegistryKey</H1>

<P>The <B>NewRegistryKey</B> method either opens an existing registry key or creates a new key in the registry. The method creates a registry-key object to represent the key and outputs a reference to this object to the caller. The caller then accesses the key through the object's <A HREF="audmp-routines_49wz.htm"><B>IRegistryKey</B></A> interface.</P>

<PRE class=syntax><B>NTSTATUS
  NewRegistryKey(
    OUT PREGISTRYKEY  *</B><I>OutRegistryKey</I><B>,</B>
<B>    IN PUNKNOWN  </B><I>OuterUnknown</I><B>  OPTIONAL,</B>
<B>    IN ULONG  </B><I>RegistryKeyType</I><B>,</B>
<B>    IN ACCESS_MASK  </B><I>DesiredAccess</I><B>,</B>
<B>    IN POBJECT_ATTRIBUTES  </B><I>ObjectAttributes</I><B>  OPTIONAL,</B>
<B>    IN ULONG  </B><I>CreateOptions</I><B>  OPTIONAL,</B>
<B>    OUT PULONG  </B><I>Disposition</I><B>  OPTIONAL</B>
<B>    );</B></PRE>

<H4>Parameters</H4>

<DL>
<DT><I>OutRegistryKey</I></DT>

<DD>Pointer to a caller-allocated pointer variable into which the method writes the reference to the <A HREF="audmp-routines_49wz.htm"><B>IRegistryKey</B></A> object. This object represents the registry key that is being opened or created. The caller must specify a valid, non-NULL pointer value for this parameter.</DD>

<DT><I>OuterUnknown</I></DT>

<DD>Pointer to the <B>IUnknown</B> interface of an object that needs to aggregate the registry key object. This parameter is optional. If aggregation is not required, specify this parameter as NULL.</DD>

<DT><I>RegistryKeyType</I></DT>

<DD>Specifies the type of registry key that the caller is requesting access to. See the following <B>Comments</B> section.</DD>

<DT><I>DesiredAccess</I></DT>

<DD>An access-control mask that specifies the type of access that the caller requires to the key. This parameter is of type <A HREF="JavaScript:hhobj_1.Click()">ACCESS_MASK</A>. See the following Comments section.</DD>

<DT><I>ObjectAttributes</I></DT>

<DD>Pointer to the object attributes of the key being created or opened. If <I>RegistryKeyType</I> has the value <B>GeneralRegistryKey</B>, this parameter must point to a valid, initialized system structure of type <A HREF="JavaScript:hhobj_2.Click()">OBJECT_ATTRIBUTES</A> with a valid <B>ObjectName</B> string for the key; otherwise, the method does not use this parameter. See the following <B>Comments</B> section.</DD>

<DT><I>CreateOptions</I></DT>

<DD>Flags indicating the create options. Can be zero if none are desired. This parameter is required if <I>RegistryKeyType</I> has the value <B>GeneralRegistryKey</B>; otherwise, the method does not use this parameter. See the following <B>Comments</B> section.</DD>

<DT><I>Disposition</I></DT>

<DD>Pointer to a caller-allocated ULONG variable into which the method writes a status value indicating whether a new key was created or an existing key was opened. This parameter is optional and can be specified as NULL if the caller does not need the status value. The method uses this parameter only if <I>RegistryKeyType</I> has the value <B>GeneralRegistryKey</B>. The method does not use the parameter for any of the other key types. See the following <B>Comments</B> section.
</DD>
</DL>

<H4>Return Value</H4>

<P><B>NewRegistryKey</B> returns STATUS_SUCCESS if the call was successful. Otherwise, the method returns an appropriate error code.</P>

<H4>Headers</H4>

<P>Declared in <I>portcls.h</I>. Include <I>portcls.h</I>.</P>

<H4>Comments</H4>

<P>The <I>DesiredAccess</I>, <I>ObjectAttributes</I>, and <I>Disposition</I> parameters take on the values that are defined for the parameters with the same names in the <A HREF="JavaScript:hhobj_3.Click()"><B>ZwCreateKey</B></A> call.</P>

<P>The <I>ObjectAttributes</I> parameter points to a structure containing object attributes such as key name and security descriptor. For more information, see <A HREF="JavaScript:hhobj_4.Click()"><B>InitializeObjectAttributes</B></A>.</P>

<P>If the <I>RegistryKeyType</I> parameter has the value <B>GeneralRegistryKey</B>, then the <B>NewRegistryKey</B> method either opens an existing registry key or creates a new key in the registry, as indicated by the value that the method outputs through the <I>Disposition</I> parameter. If the key type is any value other than <B>GeneralRegistryKey</B>, then the method opens an already existing key that was previously created during PnP device enumeration.</P>

<P>The caller should set the <I>RegistryKeyType</I> parameter to one of the enumeration values shown in the following table.</P>

<TABLE>

<TR VALIGN="top">
<TD width=41%><B><I>RegistryKeyType</I> Value</B></TD>
<TD width=59%><B>Meaning</B></TD>
</TR>

<TR VALIGN="top">
<TD width=41%><B>GeneralRegistryKey</B></TD>
<TD width=59%>Provide generic access to any key type. Opens the key if it exists or creates the key if it does not.</TD>
</TR>

<TR VALIGN="top">
<TD width=41%><B>DeviceRegistryKey</B></TD>
<TD width=59%>Open an existing key containing <I>device</I>-specific information.</TD>
</TR>

<TR VALIGN="top">
<TD width=41%><B>DriverRegistryKey</B></TD>
<TD width=59%>Open an existing key containing <I>driver</I>-specific information.</TD>
</TR>

<TR VALIGN="top">
<TD width=41%><B>HwProfileRegistryKey</B></TD>
<TD width=59%>Open an existing key relative to the current hardware profile for device or driver information. This allows the driver to access configuration information that is hardware-profile-specific.</TD>
</TR>

<TR VALIGN="top">
<TD width=41%><B>DeviceInterfaceRegistryKey</B></TD>
<TD width=59%>Open an existing registry key containing information about a particular device-interface instance.</TD>
</TR>
</TABLE><BR>

<P>If the caller sets <I>RegistryKeyType</I> to <B>GeneralRegistryKey</B>, the caller must provide valid <I>ObjectAttributes </I>and <I>CreateOptions</I> parameter values as well. For values of <I>RegistryKeyType </I>other than <B>GeneralRegistryKey</B>, the method ignores <I>ObjectAttributes</I> and <I>CreateOptions</I>.</P>

<P>The <I>DesiredAccess</I> parameter is an access-control mask. It specifies the type of access control that the caller needs to have to the new registry key when accessing it through the <I>OutRegistryKey</I> object. This mask should not be confused with the ACL (access control list) that controls access by users to the registry key. When calling <B>NewRegistryKey</B> to create a registry key of type <B>GeneralRegistryKey</B>, the <I>ObjectAttributes </I>parameter specifies the key's attributes, including a security descriptor that contains the ACL. However, if the key type is <B>GeneralRegistryKey</B> and either the security descriptor pointer in the <I>ObjectAttributes </I>structure is NULL or the ACL pointer in the security descriptor is NULL, then the new key created by the call will inherit the parent key’s ACL by default.</P>

<P>If the key is not of type <B>GeneralRegistryKey</B>, then the key retains the ACL that PnP assigned to the key when it was created during device enumeration.</P>

<P>The <B>NewRegistryKey</B> method is similar to the <A HREF="audpc-routines_1kc3.htm"><B>PcNewRegistryKey</B></A> function except that the device object and port object must be explicitly specified in a <B>PcNewRegistryKey</B> call but are simply implied in a <B>NewRegistryKey</B> call. <B>PcNewRegistryKey</B> is typically called by adapter drivers. Miniport drivers typically call <B>NewRegistryKey</B> instead.</P>

<P>Once a registry key has been created or opened by a call to either <B>NewRegistryKey</B> or <B>PcNewRegistryKey</B>, the <A HREF="audmp-routines_9l83.htm"><B>IRegistryKey::NewSubKey</B></A> method can be used to create subkeys under that key.</P>

<P>The <I>OutRegistryKey</I> and <I>OuterUnknown</I> parameters follow the <A HREF="pcdesign_1y93.htm">reference-counting conventions for COM objects</A>.</P>

<P>Callers of this method must run at IRQL PASSIVE_LEVEL.</P>

<H4>See Also</H4>

<P><A HREF="audmp-routines_49wz.htm"><B>IRegistryKey</B></A>, <A HREF="audpc-routines_1kc3.htm"><B>PcNewRegistryKey</B></A>, <A HREF="JavaScript:hhobj_5.Click()"><B>ZwCreateKey</B></A>, <A HREF="JavaScript:hhobj_6.Click()"><B>InitializeObjectAttributes</B></A>, <A HREF="JavaScript:hhobj_7.Click()">OBJECT_ATTRIBUTES</A>, <A HREF="JavaScript:hhobj_8.Click()">ACCESS_MASK</A> </P>
<DIV CLASS="footer"><A HREF="mailto:ddksurv1@microsoft.com?subject=DDK Topic Feedback&body=Build date: Thursday, January 16, 2003     Topic Title: IPort::NewRegistryKey"> Send feedback on this topic.</A> / Built on Thursday, January 16, 2003 </DIV>
</BODY>
</HTML>
