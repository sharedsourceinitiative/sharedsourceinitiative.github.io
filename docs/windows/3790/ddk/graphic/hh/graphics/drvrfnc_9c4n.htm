<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML DIR="LTR"><HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>DrvDocumentEvent</TITLE>
<SCRIPT SRC="../scripts/linkcss.js"></SCRIPT><SCRIPT SRC="../scripts/langref.js"></SCRIPT><META NAME="MS-HKWD" CONTENT="DrvDocumentEvent">
</HEAD>
<BODY TOPMARGIN="0">

<TABLE CLASS="buttonbarshade" CELLSPACING=0><TR><TD>&nbsp;</TD></TR></TABLE>
<TABLE CLASS="buttonbartable" CELLSPACING=0>
<TR ID="hdr"><TD CLASS="runninghead" NOWRAP>Display&nbsp;and&nbsp;Print&nbsp;Devices:&nbsp;Windows&nbsp;DDK</TD></TR>
</TABLE>
<H1><A NAME="ddk_drvdocumentevent_gg"></A>DrvDocumentEvent</H1>

<P>A printer interface DLL's <B>DrvDocumentEvent</B> function can handle certain events associated with printing a document.</P>

<PRE class=syntax><B>INT
  DrvDocumentEvent(</B>
    <B>HANDLE  </B><I>hPrinter</I><B>,</B>
    <B>HDC  </B><I>hdc</I><B>,</B>
    <B>int  </B><I>iEsc</I><B>,</B>
    <B>ULONG  </B><I>cbIn</I><B>,</B>
    <B>PVOID</B>  <I>pvIn</I><B>,</B>
    <B>ULONG  </B><I>cbOut</I><B>,</B>
    <B>PVOID  </B><I>pvOut</I>
    <B>);</B></PRE>

<H4>Parameters</H4>

<DL>
<DT><I>hPrinter</I></DT>

<DD>Caller-supplied printer handle.</DD>

<DT><I>hdc</I></DT>

<DD>Caller-supplied device context handle, generated by a <B>CreateDC</B> (described in the Platform SDK documentation) call. This is zero if <I>iEsc</I> is set to DOCUMENTEVENT_CREATEDCPRE.</DD>

<DT><I>iEsc</I></DT>

<DD>Caller-supplied escape code identifying the event to be handled. This parameter can be one of the following integer constants. See the Platform SDK documentation for descriptions of the functions listed in the Event column.

<TABLE>

<TR VALIGN="top">
<TH align=left width=57%><I>iEsc</I> Constant</TH>
<TH align=left width=43%>Event</TH>
</TR>

<TR VALIGN="top">
<TD width=57%>DOCUMENTEVENT_ABORTDOC</TD>
<TD width=43%>GDI is about to process a call to its <B>AbortDoc</B> function.</TD>
</TR>

<TR VALIGN="top">
<TD width=57%>DOCUMENTEVENT_CREATEDCPOST</TD>
<TD width=43%>GDI has just processed a call to its <B>CreateDC</B> or <B>CreateIC</B> function.<BR>
This escape code should not be used unless there has been a previous call to <B>DrvDocumentEvent</B> with <I>iEsc</I> set to DOCUMENTEVENT_CREATEDCPRE.</TD>
</TR>

<TR VALIGN="top">
<TD width=57%>DOCUMENTEVENT_CREATEDCPRE</TD>
<TD width=43%>GDI is about to process a call to its <B>CreateDC</B> or <B>CreateIC</B> function.</TD>
</TR>

<TR VALIGN="top">
<TD width=57%>DOCUMENTEVENT_DELETEDC</TD>
<TD width=43%>GDI is about to process a call to its <B>DeleteDC</B> function.</TD>
</TR>

<TR VALIGN="top">
<TD width=57%>DOCUMENTEVENT_ENDDOCPOST</TD>
<TD width=43%>GDI has just processed a call to its <B>EndDoc</B> function.</TD>
</TR>

<TR VALIGN="top">
<TD width=57%>DOCUMENTEVENT_ENDDOCPRE<BR>
<I>or</I> DOCUMENTEVENT_ENDDOC</TD>
<TD width=43%>GDI is about to process a call to its <B>EndDoc</B> function.</TD>
</TR>

<TR VALIGN="top">
<TD width=57%>DOCUMENTEVENT_ENDPAGE</TD>
<TD width=43%>GDI is about to process a call to its <B>EndPage</B> function.</TD>
</TR>

<TR VALIGN="top">
<TD width=57%>DOCUMENTEVENT_ESCAPE</TD>
<TD width=43%>GDI is about to process a call to its <B>ExtEscape</B> function.</TD>
</TR>

<TR VALIGN="top">
<TD width=57%>DOCUMENTEVENT_QUERYFILTER</TD>
<TD width=43%>The DOCUMENTEVENT_QUERYFILTER event represents an opportunity for the spooler to query the driver for a list of the DOCUMENTEVENT_<I>XXX</I> events to which the driver will respond. This event is issued just prior to a call to <B>DrvDocumentEvent</B> that passes the DOCUMENTEVENT_CREATEDCPRE event.</TD>
</TR>

<TR VALIGN="top">
<TD width=57%>DOCUMENTEVENT_RESETDCPOST</TD>
<TD width=43%>GDI has just processed a call to its <B>ResetDC</B> function.<BR>
This escape code should not be used unless there has been a previous call to <B>DrvDocumentEvent</B> with <I>iEsc</I> set to DOCUMENTEVENT_RESETDCPRE.</TD>
</TR>

<TR VALIGN="top">
<TD width=57%>DOCUMENTEVENT_RESETDCPRE</TD>
<TD width=43%>GDI is about to process a call to its <B>ResetDC</B> function.</TD>
</TR>

<TR VALIGN="top">
<TD width=57%>DOCUMENTEVENT_STARTDOCPOST</TD>
<TD width=43%>GDI has just processed a call to its <B>StartDoc</B> function.</TD>
</TR>

<TR VALIGN="top">
<TD width=57%>DOCUMENTEVENT_STARTDOCPRE<BR>
<I>or</I> DOCUMENTEVENT_STARTDOC</TD>
<TD width=43%>GDI is about to process a call to its <B>StartDoc</B> function.</TD>
</TR>

<TR VALIGN="top">
<TD width=57%>DOCUMENTEVENT_STARTPAGE</TD>
<TD width=43%>GDI is about to process a call to its <B>StartPage</B> function.</TD>
</TR>
</TABLE><BR>

</DD>

<DT><I>cbIn</I></DT>

<DD>Caller-supplied size, in bytes, of the buffer pointed to by <I>pvIn</I>.</DD>

<DT><I>pvIn</I></DT>

<DD>Caller-supplied pointer, the use of which is dependent on the value supplied for <I>iEsc</I>, as follows:

<TABLE>

<TR VALIGN="top">
<TH align=left width=59%><I>iEsc</I> Constant</TH>
<TH align=left width=41%><I>pvIn</I> Contents</TH>
</TR>

<TR VALIGN="top">
<TD width=59%>DOCUMENTEVENT_ABORTDOC</TD>
<TD width=41%>Not used.</TD>
</TR>

<TR VALIGN="top">
<TD width=59%>DOCUMENTEVENT_CREATEDCPOST</TD>
<TD width=41%><I>pvIn</I> contains the address of a pointer to the <A HREF="grstrcts_6v8n.htm">DEVMODE</A> structure specified in the <I>pvOut</I> parameter in a previous call to this function, for which the <I>iEsc</I> parameter was set to DOCUMENTEVENT_CREATEDCPRE.</TD>
</TR>

<TR VALIGN="top">
<TD width=59%>DOCUMENTEVENT_CREATEDCPRE</TD>
<TD width=41%><I>pvIn </I>points to a <A HREF="drvrfnc_6rvr.htm">DOCEVENT_CREATEDCPRE</A> structure.</TD>
</TR>

<TR VALIGN="top">
<TD width=59%>DOCUMENTEVENT_DELETEDC</TD>
<TD width=41%>Not used.</TD>
</TR>

<TR VALIGN="top">
<TD width=59%>DOCUMENTEVENT_ENDDOCPOST</TD>
<TD width=41%>Not used.</TD>
</TR>

<TR VALIGN="top">
<TD width=59%>DOCUMENTEVENT_ENDDOCPRE<BR>
<I>or</I> DOCUMENTEVENT_ENDDOC</TD>
<TD width=41%>Not used.</TD>
</TR>

<TR VALIGN="top">
<TD width=59%>DOCUMENTEVENT_ENDPAGE</TD>
<TD width=41%>Not used.</TD>
</TR>

<TR VALIGN="top">
<TD width=59%>DOCUMENTEVENT_ESCAPE</TD>
<TD width=41%><I>pvIn</I> points to a <A HREF="drvrfnc_6j3b.htm">DOCEVENT_ESCAPE</A> structure.</TD>
</TR>

<TR VALIGN="top">
<TD width=59%>DOCUMENTEVENT_QUERYFILTER</TD>
<TD width=41%>Same as for DOCUMENTEVENT_CREATEDCPRE.</TD>
</TR>

<TR VALIGN="top">
<TD width=59%>DOCUMENTEVENT_RESETDCPOST</TD>
<TD width=41%><I>pvIn</I> contains the address of a pointer to the <A HREF="grstrcts_6v8n.htm">DEVMODE</A> structure specified in the <I>pvOut</I> parameter in a previous call to this function, for which the <I>iEsc</I> parameter was set to DOCUMENTEVENT_RESETDCPRE.</TD>
</TR>

<TR VALIGN="top">
<TD width=59%>DOCUMENTEVENT_RESETDCPRE</TD>
<TD width=41%><I>pvIn</I> contains the address of a pointer to the <A HREF="grstrcts_6v8n.htm">DEVMODE</A> structure supplied by the caller of <B>ResetDC</B> (described in the Platform SDK documentation).</TD>
</TR>

<TR VALIGN="top">
<TD width=59%>DOCUMENTEVENT_STARTDOCPOST</TD>
<TD width=41%><I>pvIn</I> points to a LONG that specifies the print job identifier returned by <B>StartDoc</B> (described in the Platform SDK documentation).</TD>
</TR>

<TR VALIGN="top">
<TD width=59%>DOCUMENTEVENT_STARTDOCPRE<BR>
<I>or</I> DOCUMENTEVENT_STARTDOC</TD>
<TD width=41%><I>pvIn</I> contains the address of a pointer to a DOCINFO structure supplied by the caller of <B>StartDoc</B> (both described in the Platform SDK documentation). </TD>
</TR>

<TR VALIGN="top">
<TD width=59%>DOCUMENTEVENT_STARTPAGE</TD>
<TD width=41%>Not used.</TD>
</TR>
</TABLE><BR>

</DD>

<DT><I>cbOut</I></DT>

<DD>

<DL>
<DT>If <I>iEsc</I> is DOCUMENTEVENT_ESCAPE:</DT>

<DD>Function-supplied value that is used as the <I>cbOutput</I> parameter for <B>ExtEscape</B>.</DD>

<DT>If <I>iEsc</I> is DOCUMENTEVENT_QUERYFILTER:</DT>

<DD>Caller-supplied size, in bytes, of the buffer pointer to by <I>pvOut</I>.</DD>

<DT>For all other <I>iEsc</I> values:</DT>

<DD>Not used.</DD>
</DL>
</DD>

<DT><I>pvOut</I></DT>

<DD>Function-supplied pointer to an output buffer, the use of which is dependent on the value supplied for <I>iEsc</I>, as follows. <B>CreateDC</B>, <B>ExtEscape</B>, and <B>ResetDC</B> are described in the Platform SDK documentation.

<TABLE>

<TR VALIGN="top">
<TH align=left width=55%><I>iEsc</I> Constant</TH>
<TH align=left width=45%><I>pvOut</I> Contents</TH>
</TR>

<TR VALIGN="top">
<TD width=55%>DOCUMENTEVENT_CREATEDCPRE</TD>
<TD width=45%>Pointer to a driver-supplied DEVMODE structure, which GDI uses instead of the one supplied by the <B>CreateDC</B> caller. (If NULL, GDI uses the caller-supplied structure.)</TD>
</TR>

<TR VALIGN="top">
<TD width=55%>DOCUMENTEVENT_ESCAPE</TD>
<TD width=45%>Buffer pointer that is used as the <I>lpszOutData</I> parameter for <B>ExtEscape</B>.</TD>
</TR>

<TR VALIGN="top">
<TD width=55%>DOCUMENTEVENT_QUERYFILTER</TD>
<TD width=45%>Caller-supplied pointer to buffer containing a <A HREF="drvrfnc_29wn.htm">DOCEVENT_FILTER</A> structure.</TD>
</TR>

<TR VALIGN="top">
<TD width=55%>DOCUMENTEVENT_RESETDCPRE</TD>
<TD width=45%>Pointer to a driver-supplied DEVMODE structure, which GDI uses instead of the one supplied by the <B>ResetDC</B> caller. (If NULL, GDI uses the caller-supplied structure.)</TD>
</TR>

<TR VALIGN="top">
<TD width=55%>All other <I>iEsc</I> values</TD>
<TD width=45%>Not used.</TD>
</TR>
</TABLE><BR>

</DD>
</DL>

<H4>Return Value</H4>

<P>The function's return value is dependent on the escape supplied for <I>iEsc</I>. For some escape codes, the return value is not used (see the second following table). If the function supplies a return value, it must be one of the following:</P>

<TABLE>

<TR VALIGN="top">
<TH align=left width=55%>Return Value</TH>
<TH align=left width=45%>Definition</TH>
</TR>

<TR VALIGN="top">
<TD width=55%>DOCUMENTEVENT_FAILURE</TD>
<TD width=45%>The driver supports the escape code identified by <I>iEsc</I>, but a failure occurred.</TD>
</TR>

<TR VALIGN="top">
<TD width=55%>DOCUMENTEVENT_SUCCESS</TD>
<TD width=45%>The driver successfully handled the escape code identified by <I>iEsc</I>.</TD>
</TR>

<TR VALIGN="top">
<TD width=55%>DOCUMENTEVENT_UNSUPPORTED</TD>
<TD width=45%>The driver does not support the escape code identified by <I>iEsc</I>.</TD>
</TR>
</TABLE><BR>

<P>The following table indicates the escape codes that require a return value, and explains the meaning of the DOCUMENTEVENT_SUCCESS, DOCUMENTEVENT_FAILURE and DOCUMENTEVENT_UNSUPPORTED return codes.</P>

<TABLE>

<TR VALIGN="top">
<TH align=left width=55%><I>iEsc</I> Constant</TH>
<TH align=left width=45%>Meaning of Return Value</TH>
</TR>

<TR VALIGN="top">
<TD width=55%>DOCUMENTEVENT_ABORTDOC</TD>
<TD width=45%>Not used.</TD>
</TR>

<TR VALIGN="top">
<TD width=55%>DOCUMENTEVENT_CREATEDCPOST</TD>
<TD width=45%>Not used.</TD>
</TR>

<TR VALIGN="top">
<TD width=55%>DOCUMENTEVENT_CREATEDCPRE</TD>
<TD width=45%>DOCUMENTEVENT_FAILURE – GDI does not create the device context or information context, and provides a return value of 0 for <B>CreateDC</B> or <B>CreateIC</B> (both described in the Platform SDK documentation).</TD>
</TR>

<TR VALIGN="top">
<TD width=55%>DOCUMENTEVENT_DELETEDC</TD>
<TD width=45%>Not used.</TD>
</TR>

<TR VALIGN="top">
<TD width=55%>DOCUMENTEVENT_ENDDOCPOST</TD>
<TD width=45%>Not used.</TD>
</TR>

<TR VALIGN="top">
<TD width=55%>DOCUMENTEVENT_ENDDOCPRE<BR>
<I>or</I> DOCUMENTEVENT_ENDDOC</TD>
<TD width=45%>Not used.</TD>
</TR>

<TR VALIGN="top">
<TD width=55%>DOCUMENTEVENT_ENDPAGE</TD>
<TD width=45%>Not used.</TD>
</TR>

<TR VALIGN="top">
<TD width=55%>DOCUMENTEVENT_ESCAPE</TD>
<TD width=45%>Not used.</TD>
</TR>

<TR VALIGN="top">
<TD width=55%>DOCUMENTEVENT_QUERYFILTER</TD>
<TD width=45%>See <B>Comments</B>. </TD>
</TR>

<TR VALIGN="top">
<TD width=55%>DOCUMENTEVENT_RESETDCPOST</TD>
<TD width=45%>Not used.</TD>
</TR>

<TR VALIGN="top">
<TD width=55%>DOCUMENTEVENT_RESETDCPRE</TD>
<TD width=45%>DOCUMENTEVENT_FAILURE – GDI does not reset the device context, and provides a return value of 0 for <B>ResetDC</B> (described in the Platform SDK documentation).</TD>
</TR>

<TR VALIGN="top">
<TD width=55%>DOCUMENTEVENT_STARTDOCPOST</TD>
<TD width=45%>DOCUMENTEVENT_FAILURE – GDI calls <B>AbortDoc</B> to stop the document, and then provides a return value of SP_ERROR for <B>StartDoc</B> (both described in the Platform SDK documentation).</TD>
</TR>

<TR VALIGN="top">
<TD width=55%>DOCUMENTEVENT_STARTDOCPRE<BR>
<I>or</I> DOCUMENTEVENT_STARTDOC</TD>
<TD width=45%>DOCUMENTEVENT_FAILURE – GDI does not start the document, and provides a return value of SP_ERROR for <B>StartDoc</B> (described in the Platform SDK documentation).</TD>
</TR>

<TR VALIGN="top">
<TD width=55%>DOCUMENTEVENT_STARTPAGE</TD>
<TD width=45%>DOCUMENTEVENT_FAILURE – GDI does not start the page, and provides a return value of SP_ERROR for <B>StartPage</B> (described in the Platform SDK documentation).</TD>
</TR>
</TABLE><BR>

<H4>Headers</H4>

<P>Declared in <I>winddiui.h</I>. Include <I>winddiui.h</I>.</P>

<H4>Comments</H4>

<P>A <A HREF="drvarch_29pj.htm">printer interface DLL</A> can optionally provide a <B>DrvDocumentEvent</B> function to perform pre- or post-processing of GDI calls associated with rendering a document. Calls to the <B>DrvDocumentEvent</B> function are made from the user-mode GDI client, when an application makes calls into the GDI client.</P>

<P>For an <I>iEsc</I> value of DOCUMENTEVENT_QUERYFILTER, the spooler can interpret a DOCUMENTEVENT_SUCCESS value returned by <B>DrvDocumentEvent</B> in two ways, depending on whether the driver modified certain members of the <A HREF="drvrfnc_29wn.htm">DOCEVENT_FILTER</A> structure. (The <I>pvOut</I> parameter points to this structure.) When the spooler allocates memory for a structure of this type, it initializes two members of this structure, <B>cElementsReturned</B> and <B>cElementsNeeded</B>, to known values. After <B>DrvDocumentEvent</B> returns, the spooler determines whether the values of these members have changed, and uses that information to interpret the <B>DrvDocumentEvent</B> return value. The following table summarizes this situation.</P>

<TABLE>

<TR VALIGN="top">
<TH align=left width=26%>Return Value</TH>
<TH align=left width=30%>Status of cElementsReturned,<BR>
cElementsNeeded</TH>
<TH align=left width=44%>Meaning</TH>
</TR>

<TR VALIGN="top">
<TD width=26%>DOCUMENTEVENT_SUCCESS</TD>
<TD width=30%>Driver made no change to either member.</TD>
<TD width=44%>The spooler interprets this return value as equivalent to DOCUMENTEVENT_UNSUPPORTED.<BR>
The spooler is unable to retrieve the event filter from the driver, so it persists in calling <B>DrvDocumentEvent</B> for all events.</TD>
</TR>

<TR VALIGN="top">
<TD width=26%>DOCUMENTEVENT_SUCCESS</TD>
<TD width=30%>Driver wrote to one or both members.</TD>
<TD width=44%>The spooler accepts this return value without interpretation. If the driver wrote to only one of <B>cElementsNeeded</B> and <B>cElementsReturned</B>, the spooler considers the unchanged member to have a value of zero.<BR>
The spooler filters out all events listed in the <B>aDocEventCall</B> member of <A HREF="drvrfnc_29wn.htm">DOCEVENT_FILTER</A>.</TD>
</TR>

<TR VALIGN="top">
<TD width=26%>DOCUMENTEVENT_UNSUPPORTED</TD>
<TD width=30%>Not applicable</TD>
<TD width=44%>The driver does not support DOCUMENTEVENT_QUERYFILTER.<BR>
The spooler is unable to retrieve the event filter from the driver, so it persists in calling <B>DrvDocumentEvent</B> for all events.</TD>
</TR>

<TR VALIGN="top">
<TD width=26%>DOCUMENTEVENT_FAILURE</TD>
<TD width=30%>Not applicable</TD>
<TD width=44%>The driver supports DOCUMENTEVENT_QUERYFILTER, but encountered an internal error.<BR>
The spooler is unable to retrieve the event filter from the driver, so it persists in calling <B>DrvDocumentEvent</B> for all events.</TD>
</TR>
</TABLE><BR>

<P>If the escape code name has no suffix or is suffixed with <B>PRE</B>, the GDI client calls <B>DrvDocumentEvent</B> just prior to calling the kernel-mode GDI rendering engine. If the escape code name is suffixed with <B>POST</B>, the GDI client calls <B>DrvDocumentEvent</B> just after the kernel-mode GDI rendering engine returns.</P>

<P>If the escape code supplied in the <I>iEsc</I> parameter is DOCUMENTEVENT_CREATEDCPRE, the following rules apply:

<UL>
	<LI>If the job is being sent directly to the printer without spooling, <I>pvIn</I> —&gt; <B>pszDevice</B> points to the printer name. (See the <A HREF="drvrfnc_6rvr.htm">DOCEVENT_CREATEDCPRE</A> structure for more information.)</LI>

	<LI>If the job is being spooled, <I>pvIn</I> —&gt; <B>pszDevice</B> points to the printer <I>port</I> name.</LI>
</UL>

<P>The <B>DrvDocumentEvent</B> function executes in the context of the user-mode caller of the GDI client function. When EMF spooling is disabled, the function can display a user interface. For example, the <B>DrvDocumentEvent</B> function for a FAX driver might display a dialog box to the user before GDI's <B>StartDoc</B> function (described in the Platform SDK documentation) is processed.</P>

<H4>See Also</H4>

<P><A HREF="drvrfnc_29wn.htm">DOCEVENT_FILTER</A>, <A HREF="drvrfnc_6rvr.htm">DOCEVENT_CREATEDCPRE</A>, <A HREF="drvrfnc_6j3b.htm">DOCEVENT_ESCAPE</A></P>
<DIV CLASS="footer"><A HREF="mailto:ddksurv1@microsoft.com?subject=DDK Topic Feedback&body=Build date: Thursday, January 16, 2003     Topic Title: DrvDocumentEvent"> Send feedback on this topic.</A> / Built on Thursday, January 16, 2003 </DIV>
</BODY>
</HTML>
