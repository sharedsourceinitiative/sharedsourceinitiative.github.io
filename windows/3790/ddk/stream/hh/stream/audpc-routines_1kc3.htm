<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML DIR="LTR"><HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>PcNewRegistryKey</TITLE>
<SCRIPT SRC="../scripts/linkcss.js"></SCRIPT><SCRIPT SRC="../scripts/langref.js"></SCRIPT><META NAME="MS-HKWD" CONTENT="PcNewRegistryKey">
</HEAD>
<BODY TOPMARGIN="0">
<DIV STYLE="display:none;">
<OBJECT ID="hhobj_1" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_access_mask_kr">
</OBJECT>
<OBJECT ID="hhobj_2" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_device_object_kr">
</OBJECT>
<OBJECT ID="hhobj_3" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_object_attributes_kr">
</OBJECT>
<OBJECT ID="hhobj_4" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_zwcreatekey_kr">
</OBJECT>
<OBJECT ID="hhobj_5" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_access_mask_kr">
</OBJECT>
<OBJECT ID="hhobj_6" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_device_object_kr">
</OBJECT>
<OBJECT ID="hhobj_7" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_object_attributes_kr">
</OBJECT>
<OBJECT ID="hhobj_8" TYPE="application/x-oleobject" CLASSID="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
	<PARAM NAME="Command" VALUE="ALink,MENU">
	<PARAM NAME="DefaultTopic" VALUE="../notopic_0pk4.htm">
	<PARAM NAME="Item1" VALUE="">
	<PARAM NAME="Item2" VALUE="ddk_zwcreatekey_kr">
</OBJECT>
</DIV>


<TABLE CLASS="buttonbarshade" CELLSPACING=0><TR><TD>&nbsp;</TD></TR></TABLE>
<TABLE CLASS="buttonbartable" CELLSPACING=0>
<TR ID="hdr"><TD CLASS="runninghead" NOWRAP>Streaming&nbsp;Devices&nbsp;(Video&nbsp;and&nbsp;Audio):&nbsp;Windows&nbsp;DDK</TD></TR>
</TABLE>
<H1><A NAME="ddk_pcnewregistrykey_ks"></A>PcNewRegistryKey</H1>

<P>The <B>PcNewRegistryKey</B> function opens or creates a new registry key and creates an <A HREF="audmp-routines_49wz.htm"><B>IRegistryKey</B></A> object to represent the key. The caller accesses the key through this object.</P>

<PRE class=syntax><B>PORTCLASSAPI NTSTATUS NTAPI
  PcNewRegistryKey(
    OUT PREGISTRYKEY  *</B><I>OutRegistryKey</I><B>,</B>
<B>    IN PUNKNOWN  </B><I>OuterUnknown</I><B>  OPTIONAL,</B>
<B>    IN ULONG  </B><I>RegistryKeyType</I><B>,</B>
<B>    IN ACCESS_MASK  </B><I>DesiredAccess</I><B>,</B>
<B>    IN PVOID  </B><I>DeviceObject</I><B>  OPTIONAL,</B>
<B>    IN PVOID  </B><I>SubDevice</I><B>  OPTIONAL,</B>
<B>    IN POBJECT_ATTRIBUTES  </B><I>ObjectAttributes</I><B>  OPTIONAL,</B>
<B>    IN ULONG  </B><I>CreateOptions</I><B>  OPTIONAL,</B>
<B>    OUT PULONG  </B><I>Disposition</I><B>  OPTIONAL</B>
<B>    );</B></PRE>

<H4>Parameters</H4>

<DL>
<DT><I>OutRegistryKey</I></DT>

<DD>Output pointer to the registry-key object created by this function. This parameter points to a caller-allocated pointer variable into which the function outputs the pointer to the <A HREF="audmp-routines_49wz.htm"><B>IRegistryKey</B></A> object. The object represents the registry key being opened or created. Specify a valid, non-NULL pointer value for this parameter.</DD>

<DT><I>OuterUnknown</I></DT>

<DD>Pointer to the <B>IUnknown</B> interface of an object that needs to aggregate the <I>OutRegistryKey</I> object. Unless aggregation is required, set this parameter to NULL.</DD>

<DT><I>RegistryKeyType</I></DT>

<DD>Specifies the type of registry key that the caller wants to create or open. See the following <B>Comments</B> section.</DD>

<DT><I>DesiredAccess</I></DT>

<DD>Specifies an access-control mask. This parameter is a structure of type <A HREF="JavaScript:hhobj_1.Click()">ACCESS_MASK</A>. It indicates the type of access that the caller is requesting to the registry key that is to be opened or created. See the following <B>Comments</B> section.</DD>

<DT><I>DeviceObject</I></DT>

<DD>Pointer to the adapter driver's device object. This pointer is cast to type PVOID. If <I>RegistryKeyType</I> is any value other than <B>GeneralRegistryKey</B>, this parameter must point to a valid, initialized system structure of type <A HREF="JavaScript:hhobj_2.Click()">DEVICE_OBJECT</A>. If the value of <I>RegistryKeyType</I> is <B>GeneralRegistryKey</B>, the <B>PcNewRegistryKey</B> function does not use this parameter. See the following <B>Comments</B> section.</DD>

<DT><I>SubDevice</I></DT>

<DD>Specifies the aspect of the device that is to be offered to clients. Adapter drivers must assign the value NULL to this parameter. See the following <B>Comments</B> section.</DD>

<DT><I>ObjectAttributes</I></DT>

<DD>Pointer to the object attributes of the key being created or opened. If <I>RegistryKeyType</I> has the value <B>GeneralRegistryKey</B>, this parameter must point to a valid, initialized system structure of type <A HREF="JavaScript:hhobj_3.Click()">OBJECT_ATTRIBUTES</A> with a valid <B>ObjectName</B> string for the key; otherwise, the function does not use this parameter. See the following <B>Comments</B> section.</DD>

<DT><I>CreateOptions</I></DT>

<DD>Specifies the create options. Can be zero if none are desired. If <I>RegistryKeyType</I> is not <B>GeneralRegistryKey</B>, the <B>PcNewRegistryKey</B> function ignores this parameter. See the following <B>Comments</B> section.</DD>

<DT><I>Disposition</I></DT>

<DD>Pointer to a variable that receives a value indicating whether or not a key was created or an existing key was opened. This parameter is optional and can be specified as NULL. If <I>RegistryKeyType</I> is any value other than <B>GeneralRegistryKey</B>, the <B>PcNewRegistryKey</B> function ignores this parameter. See the following <B>Comments</B> section.
</DD>
</DL>

<H4>Return Value</H4>

<P><B>PcNewRegistryKey</B> returns STATUS_SUCCESS if the call was successful. Otherwise, it returns an appropriate error code.</P>

<H4>Headers</H4>

<P>Declared in <I>portcls.h</I>. Include <I>portcls.h</I>.</P>

<H4>Comments</H4>

<P>If the <I>RegistryKeyType</I> parameter's value is <B>GeneralRegistryKey</B>, then the <B>PcNewRegistryKey</B> function either opens an existing key or creates a new key in the registry, as indicated by the value that the function outputs through the <I>Disposition</I> parameter. If the key is of any type other than <B>GeneralRegistryKey</B>, then the function opens an already existing key that was previously created during PnP device enumeration.</P>

<P>The <I>DesiredAccess</I>, <I>ObjectAttributes</I>, <I>CreateOptions</I>, and <I>Disposition</I> parameters take on the values that are defined for the parameters with the same names in the <A HREF="JavaScript:hhobj_4.Click()"><B>ZwCreateKey</B></A> call.</P>

<P>The <I>RegistryKeyType</I> parameter should be set to one of the enumeration values shown in the following table.</P>

<TABLE>

<TR VALIGN="top">
<TD width=41%><B><I>RegistryKeyType</I> value</B></TD>
<TD width=59%><B>Meaning</B></TD>
</TR>

<TR VALIGN="top">
<TD width=41%><B>GeneralRegistryKey</B></TD>
<TD width=59%>Provide generic access to any key type. Open the specified key if it already exists or create the key if it does not.</TD>
</TR>

<TR VALIGN="top">
<TD width=41%><B>DeviceRegistryKey</B></TD>
<TD width=59%>Open an existing key containing <I>device</I>-specific information. The key is located under the key for the device instance specified by <I>DeviceObject</I>.</TD>
</TR>

<TR VALIGN="top">
<TD width=41%><B>DriverRegistryKey</B></TD>
<TD width=59%>Open an existing key containing <I>driver</I>-specific information.</TD>
</TR>

<TR VALIGN="top">
<TD width=41%><B>HwProfileRegistryKey</B></TD>
<TD width=59%>Open an existing key relative to the current hardware profile containing device or driver information. This allows the driver to access configuration information that is hardware-profile-specific.</TD>
</TR>

<TR VALIGN="top">
<TD width=41%><B>DeviceInterfaceRegistryKey</B></TD>
<TD width=59%>Not used with <B>PcNewRegistryKey</B>. See <A HREF="audmp-routines_2jhv.htm"><B>IPort::NewRegistryKey</B></A> for details.</TD>
</TR>
</TABLE><BR>

<P>For a <I>RegistryKeyType</I> value of <B>GeneralRegistryKey</B>, the caller must provide valid <I>ObjectAttributes </I>and <I>CreateOptions</I> parameter values. For any other <I>RegistryKeyType</I> value, the caller must provide a valid <I>DeviceObject</I> parameter value.</P>

<P>The <I>DesiredAccess</I> parameter is an access-control mask. It specifies the type of access control that the caller needs to have to the new registry key when accessing it through the <I>OutRegistryKey</I> object. This mask should not be confused with the ACL (access control list) that controls access by users to the registry key. When calling <B>PcNewRegistryKey</B> to create a registry key of type <B>GeneralRegistryKey</B>, the <I>ObjectAttributes </I>parameter specifies the key's attributes, including a security descriptor that contains the ACL. However, if the new key is of type <B>GeneralRegistryKey</B> and either the security descriptor pointer in the <I>ObjectAttributes </I>structure is NULL or the ACL pointer in the security descriptor is NULL, then the new key will inherit the parent key’s ACL by default.</P>

<P>If the key is of any type other than <B>GeneralRegistryKey</B>, then the key retains the ACL that PnP assigned to the key when it was created during device enumeration.</P>

<P>The <B>PcNewRegistryKey</B> function is similar to the <A HREF="audmp-routines_2jhv.htm"><B>IPort::NewRegistryKey</B></A> method except that the device object and port object must be explicitly specified in a <B>PcNewRegistryKey</B> call but are simply implied in a <B>NewRegistryKey</B> call. <B>PcNewRegistryKey</B> is used primarily by adapter drivers. Miniport drivers typically call <B>NewRegistryKey</B> instead.</P>

<P>The <I>OutRegistryKey</I> and <I>OuterUnknown</I> parameters follow the <A HREF="pcdesign_1y93.htm">reference-counting conventions for COM objects</A>.</P>

<H4>See Also</H4>

<P><A HREF="audmp-routines_49wz.htm"><B>IRegistryKey</B></A>, <A HREF="JavaScript:hhobj_5.Click()">ACCESS_MASK</A>, <A HREF="JavaScript:hhobj_6.Click()">DEVICE_OBJECT</A>, <A HREF="JavaScript:hhobj_7.Click()">OBJECT_ATTRIBUTES</A>, <A HREF="JavaScript:hhobj_8.Click()"><B>ZwCreateKey</B></A>, <A HREF="audmp-routines_2jhv.htm"><B>IPort::NewRegistryKey</B></A> </P>
<DIV CLASS="footer"><A HREF="mailto:ddksurv1@microsoft.com?subject=DDK Topic Feedback&body=Build date: Thursday, January 16, 2003     Topic Title: PcNewRegistryKey"> Send feedback on this topic.</A> / Built on Thursday, January 16, 2003 </DIV>
</BODY>
</HTML>
